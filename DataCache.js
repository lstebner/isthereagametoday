var DataCache,DataCacheFetcher;DataCache=function(){function t(t,e,n){this.key=null!=t?t:"",this.data=null!=e?e:[],null==n&&(n=""),this.set_params(this.params)}return t.prototype.set_data=function(t){this.data=t},t.prototype.set_params=function(t){var e,n,r;if("string"!=typeof t){e=[];for(n in t)r=t[n],e.push(n+":"+r);return this.params=e.join("_")}return this.params=t},t.prototype.expires=function(){return 864e5},t.prototype.store=function(t){return this.data=null!=t?t:this.data,this.remove_existing(function(t){return function(){var e;return e=new models.DataCache({created:(new Date).getTime(),expires:(new Date).getTime()+t.expires(),slug:t.key,data:t.data}),e.save(function(e){return e?console.log("error creating DataCache '"+t.key+"': "+e):console.log("DataCache stored '"+t.key+"' "+t.data.length+" items")})}}(this))},t.prototype.fetch=function(t,e){var n,r;return n={slug:this.key,parameters:t},r=models.DataCache.findOne(n,function(t){return function(t,n){return t&&console.log("DataCache fetch error",t),"function"==typeof e?e(t||!n?!1:n.data):void 0}}(this))},t.prototype.remove_existing=function(t){return models.DataCache.find({slug:this.key},function(e){return function(n,r){var a,o,i;if(!n&&r)for(console.log("DataCache removing "+r.length+" entries for "+e.key),o=0,i=r.length;i>o;o++)a=r[o],a.remove(function(){});return"function"==typeof t?t():void 0}}(this))},t.prototype.refresh=function(){return 1},t}(),DataCacheFetcher=function(){function t(){}return t.get=function(t,e){return models.DataCache.findOne({slug:t},function(t){return function(t,n){return"function"==typeof e?e(t?!1:n.data):void 0}}(this))},t}();